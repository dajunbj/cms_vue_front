{"ast":null,"code":"import Vue from \"vue\";\nimport Router from \"vue-router\";\nimport HomeView from \"../views/HomeView.vue\";\nimport EmployeeListView from \"../views/EmployeeListView.vue\";\nimport SettingView from \"../views/SettingView.vue\";\nimport LoginView from \"../views/LoginView.vue\";\nimport axios from 'axios';\nimport routesConfig from \"./routesConfig\";\nVue.use(Router);\n\n// 动态生成路由\nconst router = new Router({\n  mode: \"history\",\n  routes: routesConfig\n});\n\n// 全局Routerの追加\nrouter.beforeEach((to, from, next) => {\n  const token = sessionStorage.getItem(\"token\");\n  const tokenExpiration = sessionStorage.getItem(\"tokenExpiration\");\n  const now = new Date().getTime();\n\n  // 現在の画面がToken検証対象かどうかを判定する\n  if (to.meta.requiresAuth) {\n    // Token有効期間チェック\n    if (!token || tokenExpiration && now > tokenExpiration) {\n      alert(\"登录状态已过期，请重新登录\");\n      sessionStorage.clear(); // sessionStorageをクリアする\n      return next(\"/login\"); // ログインせずにシステムの画面へアクセスしたい場合、直接にログイン画面へアクセスする\n    }\n\n    // Token検証\n    try {\n      axios.get(\"/auth/verify\", {\n        headers: {\n          Authorization: ` ${token}`\n        }\n      });\n      next(); // Token有効、次の画面へ遷移する\n    } catch (error) {\n      alert(\"Token 無効\");\n      sessionStorage.clear();\n      next(\"/login\");\n    }\n  } else {\n    next();\n  }\n});\nexport default router;","map":{"version":3,"names":["Vue","Router","HomeView","EmployeeListView","SettingView","LoginView","axios","routesConfig","use","router","mode","routes","beforeEach","to","from","next","token","sessionStorage","getItem","tokenExpiration","now","Date","getTime","meta","requiresAuth","alert","clear","get","headers","Authorization","error"],"sources":["D:/soft/workspace/cms_vue_front/src/router/index.js"],"sourcesContent":["import Vue from \"vue\";\r\nimport Router from \"vue-router\";\r\nimport HomeView from \"../views/HomeView.vue\";\r\nimport EmployeeListView from \"../views/EmployeeListView.vue\";\r\nimport SettingView from \"../views/SettingView.vue\";\r\nimport LoginView from \"../views/LoginView.vue\";\r\nimport axios from 'axios';\r\n\r\nimport routesConfig from \"./routesConfig\";\r\n\r\nVue.use(Router);\r\n\r\n// 动态生成路由\r\nconst router = new Router({\r\n  mode: \"history\",\r\n  routes: routesConfig,\r\n});\r\n\r\n// 全局Routerの追加\r\nrouter.beforeEach((to, from, next) => {\r\n  \r\n  const token = sessionStorage.getItem(\"token\");\r\n  const tokenExpiration = sessionStorage.getItem(\"tokenExpiration\");\r\n  const now = new Date().getTime();\r\n\r\n  // 現在の画面がToken検証対象かどうかを判定する\r\n  if (to.meta.requiresAuth) {\r\n    // Token有効期間チェック\r\n    if (!token || (tokenExpiration && now > tokenExpiration)) {\r\n      alert(\"登录状态已过期，请重新登录\");\r\n      sessionStorage.clear(); // sessionStorageをクリアする\r\n      return next(\"/login\"); // ログインせずにシステムの画面へアクセスしたい場合、直接にログイン画面へアクセスする\r\n    }\r\n\r\n    // Token検証\r\n    try {\r\n       axios.get(\"/auth/verify\", {\r\n        headers: { Authorization: ` ${token}` },\r\n      });\r\n      next(); // Token有効、次の画面へ遷移する\r\n    } catch (error) {\r\n      alert(\"Token 無効\");\r\n      sessionStorage.clear();\r\n      next(\"/login\"); \r\n    }\r\n\r\n  } else {\r\n      next();\r\n  }\r\n});\r\n\r\nexport default router;"],"mappings":"AAAA,OAAOA,GAAG,MAAM,KAAK;AACrB,OAAOC,MAAM,MAAM,YAAY;AAC/B,OAAOC,QAAQ,MAAM,uBAAuB;AAC5C,OAAOC,gBAAgB,MAAM,+BAA+B;AAC5D,OAAOC,WAAW,MAAM,0BAA0B;AAClD,OAAOC,SAAS,MAAM,wBAAwB;AAC9C,OAAOC,KAAK,MAAM,OAAO;AAEzB,OAAOC,YAAY,MAAM,gBAAgB;AAEzCP,GAAG,CAACQ,GAAG,CAACP,MAAM,CAAC;;AAEf;AACA,MAAMQ,MAAM,GAAG,IAAIR,MAAM,CAAC;EACxBS,IAAI,EAAE,SAAS;EACfC,MAAM,EAAEJ;AACV,CAAC,CAAC;;AAEF;AACAE,MAAM,CAACG,UAAU,CAAC,CAACC,EAAE,EAAEC,IAAI,EAAEC,IAAI,KAAK;EAEpC,MAAMC,KAAK,GAAGC,cAAc,CAACC,OAAO,CAAC,OAAO,CAAC;EAC7C,MAAMC,eAAe,GAAGF,cAAc,CAACC,OAAO,CAAC,iBAAiB,CAAC;EACjE,MAAME,GAAG,GAAG,IAAIC,IAAI,CAAC,CAAC,CAACC,OAAO,CAAC,CAAC;;EAEhC;EACA,IAAIT,EAAE,CAACU,IAAI,CAACC,YAAY,EAAE;IACxB;IACA,IAAI,CAACR,KAAK,IAAKG,eAAe,IAAIC,GAAG,GAAGD,eAAgB,EAAE;MACxDM,KAAK,CAAC,eAAe,CAAC;MACtBR,cAAc,CAACS,KAAK,CAAC,CAAC,CAAC,CAAC;MACxB,OAAOX,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;IACzB;;IAEA;IACA,IAAI;MACDT,KAAK,CAACqB,GAAG,CAAC,cAAc,EAAE;QACzBC,OAAO,EAAE;UAAEC,aAAa,EAAE,IAAIb,KAAK;QAAG;MACxC,CAAC,CAAC;MACFD,IAAI,CAAC,CAAC,CAAC,CAAC;IACV,CAAC,CAAC,OAAOe,KAAK,EAAE;MACdL,KAAK,CAAC,UAAU,CAAC;MACjBR,cAAc,CAACS,KAAK,CAAC,CAAC;MACtBX,IAAI,CAAC,QAAQ,CAAC;IAChB;EAEF,CAAC,MAAM;IACHA,IAAI,CAAC,CAAC;EACV;AACF,CAAC,CAAC;AAEF,eAAeN,MAAM","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}